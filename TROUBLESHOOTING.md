# 문제 해결 가이드 (Troubleshooting)

## 🔧 일반적인 오류와 해결 방법

### 1. HTTP 422: Unprocessable Entity

**의미**: 서버는 실행 중이지만 이미지 처리에 실패했습니다.

#### 📍 원인 A: "A4 용지를 찾을 수 없습니다"

**증상:**
```
오류: A4 용지를 찾을 수 없습니다.
```

**해결 방법:**

✅ **1. A4 용지가 이미지에 완전히 보이는지 확인**
```
❌ 나쁜 예:          ✅ 좋은 예:
┌──────────┐        ┌──────────────────┐
│ [A4 일부]│        │  ┌────────┐      │
│          │        │  │   A4   │ 의류 │
│   의류   │        │  └────────┘      │
└──────────┘        └──────────────────┘
```

✅ **2. A4 용지 조명 확인**
- A4 용지에 그림자가 없어야 함
- 전체적으로 밝게 비춰야 함
- 역광 피하기

✅ **3. A4 용지와 배경의 대비**
```python
# 좋은 배경 색상
- 어두운 색 배경 (검은색, 회색, 파란색 등)
- A4 용지(흰색)와 명확한 대비

# 나쁜 배경 색상
- 흰색, 밝은 노란색 등 (A4와 구분 어려움)
```

✅ **4. A4 용지 상태**
- 구겨지지 않은 깨끗한 A4 용지 사용
- 글씨나 그림이 없는 순백색 용지
- 평평하게 펼친 상태

**테스트 명령:**
```bash
# 서버 로그 확인
python api_server.py

# 별도 터미널에서 테스트
python test_client.py your_image.jpg shirt
```

#### 📍 원인 B: "의류 윤곽선을 찾을 수 없습니다"

**증상:**
```
오류: 옷 윤곽선을 찾을 수 없습니다.
오류: 바지 윤곽선을 찾을 수 없습니다.
```

**해결 방법:**

✅ **1. 배경과 의류의 대비 높이기**
```python
# 좋은 조합
- 어두운 옷 + 밝은 배경
- 밝은 옷 + 어두운 배경

# 나쁜 조합
- 비슷한 색상의 옷과 배경
```

✅ **2. 의류 펼치기**
- 주름을 최대한 펴기
- 평평한 바닥에 배치
- 소매나 바지 다리가 접히지 않도록

✅ **3. 촬영 각도**
```
❌ 나쁜 각도:        ✅ 좋은 각도:
  ↘️ (비스듬히)        ↓ (수직)
     ┌──┐            ┌────┐
     └──┘            │    │
                     └────┘
```

✅ **4. 조명**
- 전체적으로 고르게 비추기
- 그림자 최소화
- 자연광 또는 밝은 실내등 사용

#### 📍 원인 C: "의류 윤곽선이 너무 작습니다"

**증상:**
```
오류: 옷 윤곽선이 너무 작습니다.
```

**해결 방법:**

✅ **의류가 이미지의 충분한 면적 차지하도록**
```
최소 요구사항: 이미지 면적의 10% 이상

❌ 나쁜 예:          ✅ 좋은 예:
┌────────────┐      ┌──────────┐
│            │      │          │
│  작은 옷   │      │          │
│            │      │  큰 옷   │
│            │      │          │
└────────────┘      └──────────┘
```

✅ **카메라 거리 조절**
- 의류에 더 가까이
- 줌 인 사용
- 의류가 이미지의 주요 피사체가 되도록

---

### 2. HTTP 500: Internal Server Error

**의미**: 서버 내부 오류

**해결 방법:**

✅ **1. 서버 로그 확인**
```bash
python api_server.py
# 에러 메시지 확인
```

✅ **2. 패키지 재설치**
```bash
pip install --upgrade -r requirements.txt
```

✅ **3. Python 버전 확인**
```bash
python --version
# 3.8 이상이어야 함
```

---

### 3. HTTP 400: Bad Request

**의미**: 잘못된 요청 형식

**원인 및 해결:**

#### clothing_type 오류
```python
# ❌ 잘못된 타입
clothing_type = "top"      # 안됨
clothing_type = "bottom"   # 안됨

# ✅ 올바른 타입
clothing_type = "shirt"    # 상의
clothing_type = "pants"    # 하의
```

#### 이미지 파일 오류
```python
# ✅ 지원 형식
- JPEG (.jpg, .jpeg)
- PNG (.png)
- BMP (.bmp)

# ❌ 지원 안됨
- GIF (.gif)
- SVG (.svg)
- PDF (.pdf)
```

---

### 4. 연결 오류 (Connection Refused)

**의미**: 서버가 실행되지 않음

**해결 방법:**

✅ **1. 서버 실행 확인**
```bash
# Windows
start_server.bat

# Linux/Mac
./start_server.sh

# 또는 직접
python api_server.py
```

✅ **2. 포트 확인**
```bash
# 8000번 포트가 이미 사용 중인지 확인
# Windows
netstat -ano | findstr :8000

# Linux/Mac
lsof -i :8000
```

✅ **3. 방화벽 확인**
- localhost:8000 접근 허용 확인

---

### 5. 측정값이 부정확함

**원인 및 해결:**

#### 원근 왜곡
```
문제: 카메라 각도가 비스듬함
해결: 정면에서 수직으로 촬영
```

#### A4 용지 위치
```
문제: A4 용지와 의류가 다른 높이
해결: 같은 평면에 배치
```

#### 키포인트 위치
```
해결: 수동 조정 기능 사용
1. demo_with_keypoints.html 사용
2. 키포인트 자동 검출
3. 드래그로 위치 조정
4. 재측정
```

---

## 🐛 디버깅 팁

### 1. 서버 로그 모니터링
```bash
python api_server.py
# 요청마다 로그 출력됨
```

### 2. 테스트 클라이언트 사용
```bash
# 상세한 에러 정보 확인
python test_client.py image.jpg shirt

# 키포인트 조정 테스트
python test_keypoint_adjustment.py image.jpg shirt
```

### 3. API 문서 확인
```
http://localhost:8000/docs
- Swagger UI에서 직접 테스트
- 요청/응답 형식 확인
```

### 4. 브라우저 개발자 도구
```
F12 → Console 탭
- JavaScript 에러 확인
- Network 탭에서 요청/응답 확인
```

---

## 📸 올바른 촬영 체크리스트

```
촬영 전 확인사항:

✅ A4 용지
   □ 깨끗한 흰색 용지
   □ 구김 없이 평평함
   □ 이미지에 완전히 포함

✅ 의류
   □ 평평하게 펼침
   □ 주름 제거
   □ 이미지의 충분한 면적 차지

✅ 배경
   □ 단색 (무늬 없음)
   □ 의류와 대비되는 색상
   □ 평평한 바닥

✅ 조명
   □ 고르게 비춤
   □ 그림자 최소화
   □ 충분한 밝기

✅ 카메라
   □ 정면에서 수직 촬영
   □ 흔들림 없음
   □ 초점 맞춤

✅ 배치
   □ A4 용지와 의류 같은 평면
   □ A4 용지는 의류 옆에 배치
   □ 의류가 이미지 중앙에
```

---

## 🔍 단계별 디버깅 프로세스

### 문제: 422 에러 발생

**1단계: 에러 메시지 확인**
```bash
# 웹 UI의 빨간 에러 박스 확인
# 또는 터미널 로그 확인
```

**2단계: 원인 파악**
```
"A4 용지를 찾을 수 없습니다" 
   → A4 용지 문제 (위의 원인 A 참고)

"옷 윤곽선을 찾을 수 없습니다"
   → 의류/배경 문제 (위의 원인 B 참고)

"윤곽선이 너무 작습니다"
   → 촬영 거리 문제 (위의 원인 C 참고)
```

**3단계: 이미지 재촬영**
```
1. 위의 체크리스트 확인
2. 조명, 배경, 배치 개선
3. 재촬영
```

**4단계: 재시도**
```
1. 새 이미지로 테스트
2. 여전히 실패하면 키포인트 수동 조정 시도
3. 그래도 실패하면 이슈 등록
```

---

## 💡 성공 사례

### 좋은 이미지 예시
```
특징:
- A4 용지와 의류가 명확히 구분됨
- 배경이 단색
- 조명이 고름
- 정면에서 촬영
- 주름 없음

결과:
✅ A4 검출 성공
✅ 윤곽선 검출 성공
✅ 키포인트 정확
✅ 측정값 정확
```

---

## 🆘 추가 도움이 필요한 경우

1. **GitHub Issues**
   - 에러 메시지 포함
   - 이미지 샘플 첨부 (가능하면)
   - 사용 환경 (OS, Python 버전)

2. **로그 파일 제공**
   ```bash
   python api_server.py > server.log 2>&1
   # server.log 파일 공유
   ```

3. **재현 단계**
   - 어떤 이미지로 테스트했는지
   - 어떤 엔드포인트를 호출했는지
   - 전체 에러 메시지

---

## 📊 성능 최적화 팁

### 이미지 해상도
```python
권장 해상도: 1920x1080 ~ 4000x3000

너무 작음 (< 1280x720):
- A4 검출 어려움
- 키포인트 부정확

너무 큼 (> 6000x4000):
- 처리 시간 증가
- 메모리 사용 증가

최적: 2000x1500 정도
```

### 파일 크기
```
권장: 1-5MB
최대: 10MB

큰 파일은 자동으로 리사이징하여 처리됨
```

---

**버전**: 1.1.0  
**최종 업데이트**: 2025-10-31

